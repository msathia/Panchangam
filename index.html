<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïâÔ∏è ‡Æ™‡Æû‡Øç‡Æö‡Ææ‡Æô‡Øç‡Æï‡ÆÆ‡Øç - Panchangam</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header .subtitle { color: #94a3b8; font-size: 1em; margin-bottom: 15px; }
        .header .location { color: #fbbf24; font-size: 1.2em; }
        .header .time { color: #94a3b8; margin-top: 10px; }
        
        .location-select {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        .location-select label { font-weight: 500; }
        .location-select select {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-size: 1em;
            font-family: inherit;
            background: #fff;
            color: #1a1a2e;
            cursor: pointer;
            min-width: 200px;
        }
        
        .current-hora {
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
        }
        .current-hora.good { background: #d1fae5; border-left: 6px solid #10b981; }
        .current-hora.avoid { background: #fee2e2; border-left: 6px solid #ef4444; }
        .current-hora.neutral { background: #fef3c7; border-left: 6px solid #f59e0b; }
        .current-hora { color: #1a1a2e; }
        .current-hora .planet { font-size: 3em; margin-bottom: 10px; }
        .current-hora .name { font-size: 1.8em; font-weight: 600; }
        .current-hora.good .name { color: #10b981; }
        .current-hora.avoid .name { color: #ef4444; }
        .current-hora.neutral .name { color: #f59e0b; }
        .current-hora .time-range { font-size: 1.2em; color: #64748b; margin: 10px 0; }
        .current-hora .quality { 
            display: inline-block;
            padding: 8px 20px;
            color: white;
            border-radius: 20px;
            font-weight: 500;
        }
        .current-hora.good .quality { background: #10b981; }
        .current-hora.avoid .quality { background: #ef4444; }
        .current-hora.neutral .quality { background: #f59e0b; }
        
        .jupiter-box {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1a2e;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .jupiter-box h2 { margin-bottom: 15px; }
        .jupiter-box ul { list-style: none; display: flex; flex-wrap: wrap; gap: 10px; }
        .jupiter-box li { 
            padding: 10px 15px;
            background: rgba(255,255,255,0.4);
            border-radius: 10px;
            font-weight: 500;
        }
        
        .current-lagna {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
        }
        .current-lagna .rashi-symbol { font-size: 3em; margin-bottom: 10px; }
        .current-lagna .rashi-name { font-size: 1.8em; font-weight: 600; }
        .current-lagna .rashi-sanskrit { font-size: 1.2em; opacity: 0.9; margin-top: 5px; }
        .current-lagna .time-range { font-size: 1.1em; opacity: 0.85; margin: 15px 0; }
        .current-lagna .element { 
            display: inline-block;
            padding: 6px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        .lagna-schedule {
            background: rgba(255,255,255,0.95);
            color: #1a1a2e;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .lagna-schedule h2 { 
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            color: #6366f1;
        }
        tr.fire { background: #fef2f2; }
        tr.earth { background: #f0fdf4; }
        tr.air { background: #eff6ff; }
        tr.water { background: #f0f9ff; }
        tr.lagna-current { outline: 3px solid #8b5cf6; outline-offset: -3px; }
        
        .dual-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        @media (max-width: 768px) {
            .dual-panel { grid-template-columns: 1fr; }
        }
        
        /* Jathaga Kattam (South Indian Chart) Styles */
        .jathaga-container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            color: #1a1a2e;
        }
        .jathaga-container h2 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            color: #8b5cf6;
        }
        .jathaga-kattam {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            max-width: 500px;
            margin: 0 auto;
            aspect-ratio: 1;
            background: #1a1a2e;
            padding: 2px;
            border-radius: 10px;
        }
        .rashi-cell {
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            text-align: center;
            position: relative;
            min-height: 70px;
        }
        .rashi-cell.lagna {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1a2e;
        }
        .rashi-cell.center {
            grid-column: span 2;
            grid-row: span 2;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            font-size: 1.1em;
        }
        .rashi-cell .rashi-number {
            font-size: 0.7em;
            color: #94a3b8;
            position: absolute;
            top: 4px;
            left: 6px;
        }
        .rashi-cell.lagna .rashi-number,
        .rashi-cell.center .rashi-number {
            color: rgba(255,255,255,0.7);
        }
        .rashi-cell .rashi-symbol {
            font-size: 1.4em;
            margin-bottom: 2px;
        }
        .rashi-cell .rashi-tamil {
            font-size: 0.85em;
            font-weight: 500;
        }
        .rashi-cell .rashi-eng {
            font-size: 0.65em;
            color: #64748b;
        }
        .rashi-cell.lagna .rashi-eng {
            color: #1a1a2e;
            opacity: 0.7;
        }
        .rashi-cell .lagna-marker {
            font-size: 0.7em;
            background: #ef4444;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
        }
        .rashi-cell .planet-markers {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3px;
            margin-top: 5px;
        }
        .rashi-cell .planet-name {
            font-size: 0.8em;
            color: #dc2626;
            font-weight: 700;
        }
        .rashi-cell.lagna .planet-name {
            color: #7c2d12;
        }
        .rashi-cell.has-planet {
            background: #fefce8;
        }
        .rashi-cell.has-planet.lagna {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }
        .rashi-cell .rashi-symbol,
        .rashi-cell .rashi-tamil,
        .rashi-cell .rashi-eng {
            display: none;
        }
        .rashi-cell .lagna-marker {
            font-size: 0.9em;
            background: #ef4444;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            margin-top: 5px;
            font-weight: bold;
        }
        @media (max-width: 500px) {
            .rashi-cell { min-height: 55px; padding: 4px 2px; }
            .rashi-cell .rashi-symbol { font-size: 1.1em; }
            .rashi-cell .rashi-tamil { font-size: 0.75em; }
            .rashi-cell .rashi-eng { font-size: 0.55em; }
        }
        
        /* Panchang Styles */
        .panchang-container {
            background: linear-gradient(135deg, #0f766e 0%, #115e59 100%);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .panchang-container h2 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
        }
        .panchang-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        @media (max-width: 600px) {
            .panchang-grid { grid-template-columns: 1fr; }
        }
        .panchang-item {
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 15px;
        }
        .panchang-item .label {
            font-size: 0.8em;
            opacity: 0.85;
            margin-bottom: 5px;
        }
        .panchang-item .value-tamil {
            font-size: 1.3em;
            font-weight: 600;
        }
        .panchang-item .value-english {
            font-size: 0.85em;
            opacity: 0.9;
            margin-top: 3px;
        }
        .sankalpam-box {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.2) 100%);
            border: 2px solid #fbbf24;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        .sankalpam-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #fbbf24;
        }
        .sankalpam-text {
            font-size: 1.05em;
            line-height: 2;
            margin-bottom: 15px;
        }
        .sankalpam-english {
            font-size: 0.85em;
            line-height: 1.8;
            opacity: 0.85;
            font-style: italic;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 15px;
            margin-top: 10px;
        }
        .sankalpam-text .highlight,
        .sankalpam-english .highlight {
            color: #fbbf24;
            font-weight: 700;
            background: rgba(251, 191, 36, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
        }
        .panchang-item .end-time {
            font-size: 0.75em;
            color: #fbbf24;
            margin-top: 5px;
            font-weight: 500;
        }
        .panchang-item.rahu-active {
            background: rgba(239, 68, 68, 0.3);
            border: 1px solid #ef4444;
        }
        .panchang-item.rahu-active .value-tamil {
            color: #fca5a5;
        }
        
        .schedule {
            background: rgba(255,255,255,0.95);
            color: #1a1a2e;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }
        .schedule h2 { 
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #1a1a2e; color: white; font-weight: 500; }
        tr.good { background: #d1fae5; }
        tr.avoid { background: #fee2e2; }
        tr.neutral { background: #fef3c7; }
        tr.current { outline: 3px solid #3b82f6; outline-offset: -3px; }
        
        .legend {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #94a3b8;
            margin-bottom: 20px;
        }
        .legend span { margin: 0 15px; }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9em;
        }
        .footer a { color: #fbbf24; text-decoration: none; }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #94a3b8;
        }
        .loading .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #fbbf24;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8em; }
            .current-hora .planet { font-size: 2em; }
            .current-hora .name { font-size: 1.4em; }
            th, td { padding: 8px; font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üïâÔ∏è ‡Æ™‡Æû‡Øç‡Æö‡Ææ‡Æô‡Øç‡Æï‡ÆÆ‡Øç</h1>
            <div class="subtitle">Vedic Planetary Hours & Rising Signs</div>
            <div class="location" id="location-display">üìç Loading...</div>
            <div class="time" id="datetime-display">üìÖ Loading...</div>
        </div>
        
        <div class="location-select">
            <label for="city-select">Select Location:</label>
            <select id="city-select" onchange="changeLocation()">
                <option value="austin">Austin, TX</option>
                <option value="houston">Houston, TX</option>
                <option value="dallas">Dallas, TX</option>
                <option value="san_antonio">San Antonio, TX</option>
                <option value="new_york">New York, NY</option>
                <option value="los_angeles">Los Angeles, CA</option>
                <option value="chicago">Chicago, IL</option>
                <option value="san_francisco">San Francisco, CA</option>
                <option value="chennai">Chennai, India</option>
                <option value="mumbai">Mumbai, India</option>
                <option value="bangalore">Bangalore, India</option>
                <option value="delhi">Delhi, India</option>
                <option value="hyderabad">Hyderabad, India</option>
                <option value="kolkata">Kolkata, India</option>
                <option value="london">London, UK</option>
                <option value="singapore">Singapore</option>
                <option value="sydney">Sydney, Australia</option>
            </select>
        </div>
        
        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Calculating hora times...</p>
            </div>
        </div>
        
        <div class="legend">
            <strong>Hora:</strong>
            <span style="color: #10b981;">‚úì Good (Jupiter, Venus, Mercury, Moon)</span>
            <span style="color: #f59e0b;">~ Neutral (Sun)</span>
            <span style="color: #ef4444;">‚úó Avoid (Mars, Saturn)</span>
            <br><br>
            <strong>Lagna Elements:</strong>
            <span style="color: #ef4444;">üî• Fire (Aries, Leo, Sagittarius)</span>
            <span style="color: #22c55e;">üåç Earth (Taurus, Virgo, Capricorn)</span>
            <span style="color: #3b82f6;">üí® Air (Gemini, Libra, Aquarius)</span>
            <span style="color: #06b6d4;">üíß Water (Cancer, Scorpio, Pisces)</span>
        </div>
        
        <div class="footer">
            Pure JavaScript calculation - No backend required<br>
            <a href="https://github.com/msathia/HoraStatic" target="_blank">View on GitHub</a>
        </div>
    </div>

    <script>
        // Location data with coordinates
        const LOCATIONS = {
            austin: { name: "Austin, TX", lat: 30.2672, lng: -97.7431, tz: "America/Chicago" },
            houston: { name: "Houston, TX", lat: 29.7604, lng: -95.3698, tz: "America/Chicago" },
            dallas: { name: "Dallas, TX", lat: 32.7767, lng: -96.7970, tz: "America/Chicago" },
            san_antonio: { name: "San Antonio, TX", lat: 29.4241, lng: -98.4936, tz: "America/Chicago" },
            new_york: { name: "New York, NY", lat: 40.7128, lng: -74.0060, tz: "America/New_York" },
            los_angeles: { name: "Los Angeles, CA", lat: 34.0522, lng: -118.2437, tz: "America/Los_Angeles" },
            chicago: { name: "Chicago, IL", lat: 41.8781, lng: -87.6298, tz: "America/Chicago" },
            san_francisco: { name: "San Francisco, CA", lat: 37.7749, lng: -122.4194, tz: "America/Los_Angeles" },
            chennai: { name: "Chennai, India", lat: 13.0827, lng: 80.2707, tz: "Asia/Kolkata" },
            mumbai: { name: "Mumbai, India", lat: 19.0760, lng: 72.8777, tz: "Asia/Kolkata" },
            bangalore: { name: "Bangalore, India", lat: 12.9716, lng: 77.5946, tz: "Asia/Kolkata" },
            delhi: { name: "Delhi, India", lat: 28.6139, lng: 77.2090, tz: "Asia/Kolkata" },
            hyderabad: { name: "Hyderabad, India", lat: 17.3850, lng: 78.4867, tz: "Asia/Kolkata" },
            kolkata: { name: "Kolkata, India", lat: 22.5726, lng: 88.3639, tz: "Asia/Kolkata" },
            london: { name: "London, UK", lat: 51.5074, lng: -0.1278, tz: "Europe/London" },
            singapore: { name: "Singapore", lat: 1.3521, lng: 103.8198, tz: "Asia/Singapore" },
            sydney: { name: "Sydney, Australia", lat: -33.8688, lng: 151.2093, tz: "Australia/Sydney" }
        };

        // Planet data with Tamil names
        const PLANETS = {
            Sun: { emoji: "‚òÄÔ∏è", nature: "Vigorous", quality: "neutral", tamil: "‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ‡Æ©‡Øç" },
            Moon: { emoji: "üåô", nature: "Gentle", quality: "good", tamil: "‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡Æ©‡Øç" },
            Mars: { emoji: "‚ôÇÔ∏è", nature: "Aggressive", quality: "avoid", tamil: "‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç" },
            Mercury: { emoji: "‚òø", nature: "Quick", quality: "good", tamil: "‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç" },
            Jupiter: { emoji: "‚ôÉ", nature: "Fruitful", quality: "good", tamil: "‡Æï‡ØÅ‡Æ∞‡ØÅ" },
            Venus: { emoji: "‚ôÄÔ∏è", nature: "Beneficial", quality: "good", tamil: "‡Æö‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ∞‡Æ©‡Øç" },
            Saturn: { emoji: "‚ôÑ", nature: "Sluggish", quality: "avoid", tamil: "‡Æö‡Æ©‡Æø" }
        };

        // Day rulers and hora sequence
        const DAY_RULERS = ["Sun", "Moon", "Mars", "Mercury", "Jupiter", "Venus", "Saturn"];
        const HORA_SEQUENCE = ["Saturn", "Jupiter", "Mars", "Sun", "Venus", "Mercury", "Moon"];

        // Zodiac signs (Rashis) for Lagna calculation with Tamil names
        const RASHIS = [
            { name: "Aries", sanskrit: "Mesha (‡§Æ‡•á‡§∑)", tamil: "‡ÆÆ‡Øá‡Æ∑‡ÆÆ‡Øç", symbol: "‚ôà", ruler: "Mars", rulerTamil: "‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç", element: "fire", quality: "Cardinal" },
            { name: "Taurus", sanskrit: "Vrishabha (‡§µ‡•É‡§∑‡§≠)", tamil: "‡Æ∞‡Æø‡Æ∑‡Æ™‡ÆÆ‡Øç", symbol: "‚ôâ", ruler: "Venus", rulerTamil: "‡Æö‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ∞‡Æ©‡Øç", element: "earth", quality: "Fixed" },
            { name: "Gemini", sanskrit: "Mithuna (‡§Æ‡§ø‡§•‡•Å‡§®)", tamil: "‡ÆÆ‡Æø‡Æ§‡ØÅ‡Æ©‡ÆÆ‡Øç", symbol: "‚ôä", ruler: "Mercury", rulerTamil: "‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç", element: "air", quality: "Mutable" },
            { name: "Cancer", sanskrit: "Karka (‡§ï‡§∞‡•ç‡§ï)", tamil: "‡Æï‡Æü‡Æï‡ÆÆ‡Øç", symbol: "‚ôã", ruler: "Moon", rulerTamil: "‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡Æ©‡Øç", element: "water", quality: "Cardinal" },
            { name: "Leo", sanskrit: "Simha (‡§∏‡§ø‡§Ç‡§π)", tamil: "‡Æö‡Æø‡ÆÆ‡Øç‡ÆÆ‡ÆÆ‡Øç", symbol: "‚ôå", ruler: "Sun", rulerTamil: "‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ‡Æ©‡Øç", element: "fire", quality: "Fixed" },
            { name: "Virgo", sanskrit: "Kanya (‡§ï‡§®‡•ç‡§Ø‡§æ)", tamil: "‡Æï‡Æ©‡Øç‡Æ©‡Æø", symbol: "‚ôç", ruler: "Mercury", rulerTamil: "‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç", element: "earth", quality: "Mutable" },
            { name: "Libra", sanskrit: "Tula (‡§§‡•Å‡§≤‡§æ)", tamil: "‡Æ§‡ØÅ‡Æ≤‡Ææ‡ÆÆ‡Øç", symbol: "‚ôé", ruler: "Venus", rulerTamil: "‡Æö‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ∞‡Æ©‡Øç", element: "air", quality: "Cardinal" },
            { name: "Scorpio", sanskrit: "Vrishchika (‡§µ‡•É‡§∂‡•ç‡§ö‡§ø‡§ï)", tamil: "‡Æµ‡Æø‡Æ∞‡ØÅ‡Æö‡Øç‡Æö‡Æø‡Æï‡ÆÆ‡Øç", symbol: "‚ôè", ruler: "Mars", rulerTamil: "‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç", element: "water", quality: "Fixed" },
            { name: "Sagittarius", sanskrit: "Dhanu (‡§ß‡§®‡•Å)", tamil: "‡Æ§‡Æ©‡ØÅ‡Æö‡ØÅ", symbol: "‚ôê", ruler: "Jupiter", rulerTamil: "‡Æï‡ØÅ‡Æ∞‡ØÅ", element: "fire", quality: "Mutable" },
            { name: "Capricorn", sanskrit: "Makara (‡§Æ‡§ï‡§∞)", tamil: "‡ÆÆ‡Æï‡Æ∞‡ÆÆ‡Øç", symbol: "‚ôë", ruler: "Saturn", rulerTamil: "‡Æö‡Æ©‡Æø", element: "earth", quality: "Cardinal" },
            { name: "Aquarius", sanskrit: "Kumbha (‡§ï‡•Å‡§Æ‡•ç‡§≠)", tamil: "‡Æï‡ØÅ‡ÆÆ‡Øç‡Æ™‡ÆÆ‡Øç", symbol: "‚ôí", ruler: "Saturn", rulerTamil: "‡Æö‡Æ©‡Æø", element: "air", quality: "Fixed" },
            { name: "Pisces", sanskrit: "Meena (‡§Æ‡•Ä‡§®)", tamil: "‡ÆÆ‡ØÄ‡Æ©‡ÆÆ‡Øç", symbol: "‚ôì", ruler: "Jupiter", rulerTamil: "‡Æï‡ØÅ‡Æ∞‡ØÅ", element: "water", quality: "Mutable" }
        ];

        let currentLocation = "austin";

        // Get timezone offset in hours for a given timezone
        function getTimezoneOffset(timezone) {
            const now = new Date();
            const utcDate = new Date(now.toLocaleString('en-US', { timeZone: 'UTC' }));
            const tzDate = new Date(now.toLocaleString('en-US', { timeZone: timezone }));
            return (tzDate - utcDate) / (1000 * 60 * 60);
        }

        // Get the current date components in a specific timezone
        function getDateInTimezone(date, timezone) {
            const options = { timeZone: timezone, year: 'numeric', month: 'numeric', day: 'numeric', 
                             hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false };
            const parts = new Intl.DateTimeFormat('en-US', options).formatToParts(date);
            const get = (type) => parseInt(parts.find(p => p.type === type)?.value || 0);
            return {
                year: get('year'),
                month: get('month'),
                day: get('day'),
                hour: get('hour') === 24 ? 0 : get('hour'),
                minute: get('minute'),
                second: get('second'),
                dayOfWeek: new Date(get('year'), get('month') - 1, get('day')).getDay()
            };
        }

        // Calculate sunrise and sunset using astronomical formulas
        function calculateSunTimes(lat, lng, year, month, day) {
            const rad = Math.PI / 180;
            const date = new Date(year, month - 1, day);
            const dayOfYear = Math.floor((date - new Date(year, 0, 0)) / 86400000);
            
            // Solar declination
            const declination = -23.45 * Math.cos(rad * 360 / 365 * (dayOfYear + 10));
            
            // Hour angle for sunrise/sunset (with refraction correction)
            const h = -0.833; // Standard refraction
            const cosHourAngle = (Math.sin(h * rad) - Math.sin(lat * rad) * Math.sin(declination * rad)) / 
                                 (Math.cos(lat * rad) * Math.cos(declination * rad));
            const hourAngle = Math.acos(Math.max(-1, Math.min(1, cosHourAngle))) / rad;
            
            // Equation of time (approximate)
            const B = 360/365 * (dayOfYear - 81) * rad;
            const EoT = 9.87 * Math.sin(2*B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B);
            
            // Solar noon in local standard time (LST)
            const solarNoon = 12 - lng / 15 - EoT / 60;
            
            // Sunrise and sunset in hours (UTC)
            const sunriseUTC = solarNoon - hourAngle / 15;
            const sunsetUTC = solarNoon + hourAngle / 15;
            
            return { sunrise: sunriseUTC, sunset: sunsetUTC };
        }

        // Convert UTC hours to a time object {hour, minute} in local timezone
        function utcHoursToLocalTime(utcHours, tzOffset) {
            let localHours = utcHours + tzOffset;
            // Handle day overflow
            if (localHours >= 24) localHours -= 24;
            if (localHours < 0) localHours += 24;
            
            const hour = Math.floor(localHours);
            const minute = Math.round((localHours - hour) * 60);
            return { hour, minute };
        }

        // Format time object as HH:MM AM/PM
        function formatTimeObj(timeObj) {
            const hour = timeObj.hour;
            const minute = timeObj.minute;
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minute.toString().padStart(2, '0')} ${ampm}`;
        }

        // Convert time object to minutes since midnight
        function timeObjToMinutes(timeObj) {
            return timeObj.hour * 60 + timeObj.minute;
        }

        // Add minutes to time object
        function addMinutesToTime(timeObj, minutes) {
            let totalMinutes = timeObj.hour * 60 + timeObj.minute + minutes;
            if (totalMinutes >= 24 * 60) totalMinutes -= 24 * 60;
            if (totalMinutes < 0) totalMinutes += 24 * 60;
            return {
                hour: Math.floor(totalMinutes / 60),
                minute: Math.round(totalMinutes % 60)
            };
        }

        // Calculate hora schedule
        function calculateHoraSchedule(location) {
            const loc = LOCATIONS[location];
            const now = new Date();
            const tzOffset = getTimezoneOffset(loc.tz);
            const localDate = getDateInTimezone(now, loc.tz);
            
            // Calculate sun times for today
            const sunTimes = calculateSunTimes(loc.lat, loc.lng, localDate.year, localDate.month, localDate.day);
            const sunrise = utcHoursToLocalTime(sunTimes.sunrise, tzOffset);
            const sunset = utcHoursToLocalTime(sunTimes.sunset, tzOffset);
            
            // Calculate sun times for tomorrow (for next sunrise)
            const tomorrow = new Date(localDate.year, localDate.month - 1, localDate.day + 1);
            const tomorrowParts = getDateInTimezone(tomorrow, loc.tz);
            const nextSunTimes = calculateSunTimes(loc.lat, loc.lng, tomorrowParts.year, tomorrowParts.month, tomorrowParts.day);
            const nextSunrise = utcHoursToLocalTime(nextSunTimes.sunrise, tzOffset);
            
            // Day duration in minutes
            let dayDuration = timeObjToMinutes(sunset) - timeObjToMinutes(sunrise);
            if (dayDuration < 0) dayDuration += 24 * 60;
            
            // Night duration in minutes (sunset to next sunrise)
            let nightDuration = (24 * 60 - timeObjToMinutes(sunset)) + timeObjToMinutes(nextSunrise);
            
            // Each hora duration in minutes
            const dayHoraDuration = dayDuration / 12;
            const nightHoraDuration = nightDuration / 12;
            
            // Determine starting planet based on day of week
            const dayOfWeek = localDate.dayOfWeek;
            const dayRuler = DAY_RULERS[dayOfWeek];
            const startIndex = HORA_SEQUENCE.indexOf(dayRuler);
            
            const schedule = [];
            
            // Day horas (12)
            for (let i = 0; i < 12; i++) {
                const planetIndex = (startIndex + i) % 7;
                const planet = HORA_SEQUENCE[planetIndex];
                const start = addMinutesToTime(sunrise, i * dayHoraDuration);
                const end = addMinutesToTime(sunrise, (i + 1) * dayHoraDuration);
                
                schedule.push({
                    planet,
                    ...PLANETS[planet],
                    start: formatTimeObj(start),
                    end: formatTimeObj(end),
                    startMinutes: timeObjToMinutes(start),
                    endMinutes: timeObjToMinutes(end),
                    isDay: true
                });
            }
            
            // Night horas (12) - continue from where day left off
            for (let i = 0; i < 12; i++) {
                const planetIndex = (startIndex + 12 + i) % 7;
                const planet = HORA_SEQUENCE[planetIndex];
                const start = addMinutesToTime(sunset, i * nightHoraDuration);
                const end = addMinutesToTime(sunset, (i + 1) * nightHoraDuration);
                
                let startMins = timeObjToMinutes(start);
                let endMins = timeObjToMinutes(end);
                // Handle overnight times
                if (startMins < timeObjToMinutes(sunset)) startMins += 24 * 60;
                if (endMins < timeObjToMinutes(sunset)) endMins += 24 * 60;
                if (endMins <= startMins) endMins += 24 * 60;
                
                schedule.push({
                    planet,
                    ...PLANETS[planet],
                    start: formatTimeObj(start),
                    end: formatTimeObj(end),
                    startMinutes: startMins,
                    endMinutes: endMins,
                    isDay: false
                });
            }
            
            return {
                location: loc.name,
                sunrise: formatTimeObj(sunrise),
                sunset: formatTimeObj(sunset),
                localDate: localDate,
                schedule
            };
        }

        // Find current hora
        function findCurrentHora(schedule, localDate, sunset) {
            let currentMinutes = localDate.hour * 60 + localDate.minute;
            
            // If after sunset, add 24*60 for comparison
            const sunsetMinutes = schedule.find(h => !h.isDay)?.startMinutes || 0;
            if (currentMinutes < 6 * 60) { // If before 6 AM, it's probably night from previous day
                currentMinutes += 24 * 60;
            }
            
            for (let i = 0; i < schedule.length; i++) {
                const hora = schedule[i];
                if (currentMinutes >= hora.startMinutes && currentMinutes < hora.endMinutes) {
                    return { current: hora, index: i, next: schedule[i + 1] || schedule[0] };
                }
            }
            return { current: schedule[0], index: 0, next: schedule[1] };
        }

        // ==================== LAGNA CALCULATIONS ====================
        
        // Calculate Julian Day Number from UTC date/time
        function getJulianDayUTC(year, month, day, hour, minute, second) {
            // Adjust for hours outside 0-24 range
            let totalHours = hour + minute / 60 + (second || 0) / 3600;
            while (totalHours >= 24) {
                totalHours -= 24;
                day += 1;
            }
            while (totalHours < 0) {
                totalHours += 24;
                day -= 1;
            }
            
            // Handle month/day overflow
            const dt = new Date(Date.UTC(year, month - 1, day, Math.floor(totalHours), (totalHours % 1) * 60));
            year = dt.getUTCFullYear();
            month = dt.getUTCMonth() + 1;
            day = dt.getUTCDate();
            totalHours = dt.getUTCHours() + dt.getUTCMinutes() / 60 + dt.getUTCSeconds() / 3600;
            
            if (month <= 2) {
                year -= 1;
                month += 12;
            }
            const A = Math.floor(year / 100);
            const B = 2 - A + Math.floor(A / 4);
            const JD = Math.floor(365.25 * (year + 4716)) + Math.floor(30.6001 * (month + 1)) + day + totalHours / 24 + B - 1524.5;
            return JD;
        }

        // Calculate Greenwich Mean Sidereal Time (GMST) in degrees
        function getGMST(jd) {
            const T = (jd - 2451545.0) / 36525;
            let gmst = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 0.000387933 * T * T - T * T * T / 38710000;
            gmst = ((gmst % 360) + 360) % 360; // Normalize to 0-360
            return gmst;
        }

        // Calculate Local Sidereal Time (LST) in degrees
        function getLST(gmst, longitude) {
            let lst = gmst + longitude;
            lst = ((lst % 360) + 360) % 360; // Normalize to 0-360
            return lst;
        }

        // Get obliquity of ecliptic for a given Julian Day
        function getObliquity(jd) {
            const T = (jd - 2451545.0) / 36525;
            return 23.439291 - 0.0130042 * T;
        }

        // Calculate Lahiri Ayanamsa for a given Julian Day
        // Ayanamsa is the difference between tropical and sidereal zodiac
        function getLahiriAyanamsa(jd) {
            const T = (jd - 2451545.0) / 36525; // Centuries from J2000.0
            // Lahiri Ayanamsa formula (precession)
            // At J2000.0 (Jan 1, 2000), Lahiri Ayanamsa was approximately 23.856¬∞
            // Precession rate is approximately 50.29" per year = 0.01397¬∞ per year
            const ayanamsa = 23.856 + (0.01397 * T * 100);
            return ayanamsa;
        }

        // Calculate the Ascendant (Lagna) degree using Swiss Ephemeris formula
        function calculateAscendant(lstDegrees, latitudeDegrees, obliquityDegrees) {
            const rad = Math.PI / 180;
            const ARMC = lstDegrees * rad; // Sidereal Time in radians
            const lat = latitudeDegrees * rad;
            const eps = obliquityDegrees * rad; // Obliquity of ecliptic
            
            // Swiss Ephemeris Ascendant formula:
            // tan(ASC) = cos(ARMC) / -(sin(Œµ) √ó tan(œÜ) + cos(Œµ) √ó sin(ARMC))
            const y = Math.cos(ARMC);
            const x = -(Math.sin(eps) * Math.tan(lat) + Math.cos(eps) * Math.sin(ARMC));
            
            let asc = Math.atan2(y, x) / rad;
            
            // Normalize to 0-360
            asc = ((asc % 360) + 360) % 360;
            
            return asc;
        }

        // Get Rashi (zodiac sign) from degree (0-360)
        function getRashiFromDegree(degree) {
            degree = ((degree % 360) + 360) % 360;
            const rashiIndex = Math.floor(degree / 30);
            const degreeInRashi = degree % 30;
            return { ...RASHIS[rashiIndex], index: rashiIndex, degree: degreeInRashi };
        }

        // Calculate Lagna for a specific local time at a location
        function calculateLagnaAt(location, localHour, localMinute, localDate) {
            const loc = LOCATIONS[location];
            const tzOffset = getTimezoneOffset(loc.tz);
            
            // Convert local time to UTC
            const utcHour = localHour - tzOffset;
            const jd = getJulianDayUTC(localDate.year, localDate.month, localDate.day, utcHour, localMinute, 0);
            
            const gmst = getGMST(jd);
            const lst = getLST(gmst, loc.lng);
            const obliquity = getObliquity(jd);
            const tropicalAsc = calculateAscendant(lst, loc.lat, obliquity);
            
            // Convert tropical to sidereal (Vedic) by subtracting Ayanamsa
            const ayanamsa = getLahiriAyanamsa(jd);
            let siderealAsc = tropicalAsc - ayanamsa;
            siderealAsc = ((siderealAsc % 360) + 360) % 360; // Normalize to 0-360
            
            return getRashiFromDegree(siderealAsc);
        }

        // Calculate Lagna schedule for the day
        function calculateLagnaSchedule(location) {
            const loc = LOCATIONS[location];
            const now = new Date();
            const localDate = getDateInTimezone(now, loc.tz);
            
            // Find when each Lagna starts by iterating through the day
            let prevRashi = -1;
            let lagnaStart = null;
            const lagnaEntries = [];
            
            // Check every 1 minute for Lagna changes (more accurate)
            for (let mins = 0; mins <= 24 * 60; mins += 1) {
                const hour = Math.floor(mins / 60);
                const minute = mins % 60;
                const rashi = calculateLagnaAt(location, hour, minute, localDate);
                
                if (rashi.index !== prevRashi) {
                    if (lagnaStart !== null && prevRashi >= 0) {
                        lagnaEntries.push({
                            ...RASHIS[prevRashi],
                            index: prevRashi,
                            start: formatTimeObj(lagnaStart),
                            end: formatTimeObj({ hour, minute }),
                            startMinutes: timeObjToMinutes(lagnaStart),
                            endMinutes: mins
                        });
                    }
                    lagnaStart = { hour, minute };
                    prevRashi = rashi.index;
                }
            }
            
            // Add the last entry (wraps to next day)
            if (lagnaStart !== null && prevRashi >= 0) {
                lagnaEntries.push({
                    ...RASHIS[prevRashi],
                    index: prevRashi,
                    start: formatTimeObj(lagnaStart),
                    end: "12:00 AM+",
                    startMinutes: timeObjToMinutes(lagnaStart),
                    endMinutes: 24 * 60
                });
            }
            
            return lagnaEntries;
        }

        // Find current Lagna from schedule
        function findCurrentLagnaFromSchedule(schedule, localDate) {
            const currentMinutes = localDate.hour * 60 + localDate.minute;
            
            for (let i = 0; i < schedule.length; i++) {
                const lagna = schedule[i];
                if (currentMinutes >= lagna.startMinutes && currentMinutes < lagna.endMinutes) {
                    return { current: lagna, index: i, next: schedule[(i + 1) % schedule.length] };
                }
            }
            // Default to first entry if not found
            return { current: schedule[0], index: 0, next: schedule[1] || schedule[0] };
        }

        // ==================== END LAGNA CALCULATIONS ====================

        // ==================== PANCHANG CALCULATIONS ====================
        
        // Tamil weekday names with Sanskrit equivalents (Vara)
        const TAMIL_DAYS = ['‡Æû‡Ææ‡ÆØ‡Æø‡Æ±‡ØÅ', '‡Æ§‡Æø‡Æô‡Øç‡Æï‡Æ≥‡Øç', '‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç', '‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç', '‡Æµ‡Æø‡ÆØ‡Ææ‡Æ¥‡Æ©‡Øç', '‡Æµ‡ØÜ‡Æ≥‡Øç‡Æ≥‡Æø', '‡Æö‡Æ©‡Æø'];
        const ENGLISH_DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const SANSKRIT_DAYS = ['‡Æ™‡Ææ‡Æ©‡ØÅ', '‡Æá‡Æ®‡Øç‡Æ§‡ØÅ', '‡Æ™‡Øå‡ÆÆ', '‡Æö‡Øå‡ÆÆ‡Øç‡ÆØ', '‡Æï‡ØÅ‡Æ∞‡ØÅ', '‡Æ™‡Øç‡Æ∞‡ØÅ‡Æï‡ØÅ', '‡Æ∏‡Øç‡Æ§‡Æø‡Æ∞'];
        const SANSKRIT_DAYS_ENG = ['Bhanu', 'Indu', 'Bhauma', 'Saumya', 'Guru', 'Bhrigu', 'Sthira'];
        
        // Tithi names (15 for each paksha)
        const TITHIS = [
            { tamil: '‡Æ™‡Æø‡Æ∞‡Æ§‡ÆÆ‡Øà', english: 'Prathama' },
            { tamil: '‡Æ§‡Øç‡Æµ‡Æø‡Æ§‡ØÄ‡ÆØ‡Øà', english: 'Dwitiya' },
            { tamil: '‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ§‡ØÄ‡ÆØ‡Øà', english: 'Tritiya' },
            { tamil: '‡Æö‡Æ§‡ØÅ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø', english: 'Chaturthi' },
            { tamil: '‡Æ™‡Æû‡Øç‡Æö‡ÆÆ‡Æø', english: 'Panchami' },
            { tamil: '‡Æ∑‡Æ∑‡Øç‡Æü‡Æø', english: 'Shashthi' },
            { tamil: '‡Æö‡Æ™‡Øç‡Æ§‡ÆÆ‡Æø', english: 'Saptami' },
            { tamil: '‡ÆÖ‡Æ∑‡Øç‡Æü‡ÆÆ‡Æø', english: 'Ashtami' },
            { tamil: '‡Æ®‡Æµ‡ÆÆ‡Æø', english: 'Navami' },
            { tamil: '‡Æ§‡Æö‡ÆÆ‡Æø', english: 'Dashami' },
            { tamil: '‡Æè‡Æï‡Ææ‡Æ§‡Æö‡Æø', english: 'Ekadashi' },
            { tamil: '‡Æ§‡Øç‡Æµ‡Ææ‡Æ§‡Æö‡Æø', english: 'Dwadashi' },
            { tamil: '‡Æ§‡Øç‡Æ∞‡ÆØ‡Øã‡Æ§‡Æö‡Æø', english: 'Trayodashi' },
            { tamil: '‡Æö‡Æ§‡ØÅ‡Æ∞‡Øç‡Æ§‡Æö‡Æø', english: 'Chaturdashi' },
            { tamil: '‡Æ™‡ØÇ‡Æ∞‡Øç‡Æ£‡Æø‡ÆÆ‡Øà', english: 'Purnima' } // or Amavasya for Krishna
        ];
        
        // 27 Nakshatras
        const NAKSHATRAS = [
            { tamil: '‡ÆÖ‡Æ∏‡Øç‡Æµ‡Æø‡Æ©‡Æø', english: 'Ashwini' },
            { tamil: '‡Æ™‡Æ∞‡Æ£‡Æø', english: 'Bharani' },
            { tamil: '‡Æï‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡Æï‡Øà', english: 'Krittika' },
            { tamil: '‡Æ∞‡Øã‡Æï‡Æø‡Æ£‡Æø', english: 'Rohini' },
            { tamil: '‡ÆÆ‡Æø‡Æ∞‡ØÅ‡Æï‡Æö‡ØÄ‡Æ∞‡Æø‡Æ∑‡ÆÆ‡Øç', english: 'Mrigashira' },
            { tamil: '‡Æ§‡Æø‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æ§‡Æø‡Æ∞‡Øà', english: 'Ardra' },
            { tamil: '‡Æ™‡ØÅ‡Æ©‡Æ∞‡Øç‡Æ™‡ØÇ‡Æö‡ÆÆ‡Øç', english: 'Punarvasu' },
            { tamil: '‡Æ™‡ØÇ‡Æö‡ÆÆ‡Øç', english: 'Pushya' },
            { tamil: '‡ÆÜ‡ÆØ‡Æø‡Æ≤‡Øç‡ÆØ‡ÆÆ‡Øç', english: 'Ashlesha' },
            { tamil: '‡ÆÆ‡Æï‡ÆÆ‡Øç', english: 'Magha' },
            { tamil: '‡Æ™‡ØÇ‡Æ∞‡ÆÆ‡Øç', english: 'Purva Phalguni' },
            { tamil: '‡Æâ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ÆÆ‡Øç', english: 'Uttara Phalguni' },
            { tamil: '‡ÆÖ‡Æ∏‡Øç‡Æ§‡ÆÆ‡Øç', english: 'Hasta' },
            { tamil: '‡Æö‡Æø‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Øà', english: 'Chitra' },
            { tamil: '‡Æö‡ØÅ‡Æµ‡Ææ‡Æ§‡Æø', english: 'Swati' },
            { tamil: '‡Æµ‡Æø‡Æö‡Ææ‡Æï‡ÆÆ‡Øç', english: 'Vishakha' },
            { tamil: '‡ÆÖ‡Æ©‡ØÅ‡Æ∑‡ÆÆ‡Øç', english: 'Anuradha' },
            { tamil: '‡Æï‡Øá‡Æü‡Øç‡Æü‡Øà', english: 'Jyeshtha' },
            { tamil: '‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç', english: 'Moola' },
            { tamil: '‡Æ™‡ØÇ‡Æ∞‡Ææ‡Æü‡ÆÆ‡Øç', english: 'Purva Ashadha' },
            { tamil: '‡Æâ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Ææ‡Æü‡ÆÆ‡Øç', english: 'Uttara Ashadha' },
            { tamil: '‡Æ§‡Æø‡Æ∞‡ØÅ‡Æµ‡Øã‡Æ£‡ÆÆ‡Øç', english: 'Shravana' },
            { tamil: '‡ÆÖ‡Æµ‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Øç', english: 'Dhanishta' },
            { tamil: '‡Æö‡Æ§‡ÆØ‡ÆÆ‡Øç', english: 'Shatabhisha' },
            { tamil: '‡Æ™‡ØÇ‡Æ∞‡Æü‡Øç‡Æü‡Ææ‡Æ§‡Æø', english: 'Purva Bhadrapada' },
            { tamil: '‡Æâ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æü‡Øç‡Æü‡Ææ‡Æ§‡Æø', english: 'Uttara Bhadrapada' },
            { tamil: '‡Æ∞‡Øá‡Æµ‡Æ§‡Æø', english: 'Revati' }
        ];
        
        // 27 Yogas
        const YOGAS = [
            { tamil: '‡Æµ‡Æø‡Æ∑‡Øç‡Æï‡ÆÆ‡Øç‡Æ™‡ÆÆ‡Øç', english: 'Vishkambha' },
            { tamil: '‡Æ™‡Øç‡Æ∞‡ØÄ‡Æ§‡Æø', english: 'Priti' },
            { tamil: '‡ÆÜ‡ÆØ‡ØÅ‡Æ∑‡Øç‡ÆÆ‡Ææ‡Æ©‡Øç', english: 'Ayushman' },
            { tamil: '‡Æö‡Øå‡Æ™‡Ææ‡Æï‡Øç‡ÆØ‡ÆÆ‡Øç', english: 'Saubhagya' },
            { tamil: '‡Æö‡Øã‡Æ™‡Æ©‡ÆÆ‡Øç', english: 'Shobhana' },
            { tamil: '‡ÆÖ‡Æ§‡Æø‡Æï‡Æ£‡Øç‡Æü‡ÆÆ‡Øç', english: 'Atiganda' },
            { tamil: '‡Æö‡ØÅ‡Æï‡Æ∞‡Øç‡ÆÆ‡Ææ', english: 'Sukarma' },
            { tamil: '‡Æ§‡Øç‡Æ∞‡ØÅ‡Æ§‡Æø', english: 'Dhriti' },
            { tamil: '‡Æö‡ØÇ‡Æ≤‡ÆÆ‡Øç', english: 'Shoola' },
            { tamil: '‡Æï‡Æ£‡Øç‡Æü‡ÆÆ‡Øç', english: 'Ganda' },
            { tamil: '‡Æµ‡Æø‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡Æø', english: 'Vriddhi' },
            { tamil: '‡Æ§‡Øç‡Æ∞‡ØÅ‡Æµ‡ÆÆ‡Øç', english: 'Dhruva' },
            { tamil: '‡Æµ‡Øç‡ÆØ‡Ææ‡Æï‡Ææ‡Æ§‡ÆÆ‡Øç', english: 'Vyaghata' },
            { tamil: '‡Æπ‡Æ∞‡Øç‡Æ∑‡Æ£‡ÆÆ‡Øç', english: 'Harshana' },
            { tamil: '‡Æµ‡Æú‡Øç‡Æ∞‡ÆÆ‡Øç', english: 'Vajra' },
            { tamil: '‡Æö‡Æø‡Æ§‡Øç‡Æ§‡Æø', english: 'Siddhi' },
            { tamil: '‡Æµ‡Øç‡ÆØ‡Æ§‡ØÄ‡Æ™‡Ææ‡Æ§‡ÆÆ‡Øç', english: 'Vyatipata' },
            { tamil: '‡Æµ‡Æ∞‡ØÄ‡ÆØ‡Ææ‡Æ©‡Øç', english: 'Variyan' },
            { tamil: '‡Æ™‡Æ∞‡Æø‡Æï‡ÆÆ‡Øç', english: 'Parigha' },
            { tamil: '‡Æö‡Æø‡Æµ‡ÆÆ‡Øç', english: 'Shiva' },
            { tamil: '‡Æö‡Æø‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç', english: 'Siddha' },
            { tamil: '‡Æö‡Ææ‡Æ§‡Øç‡ÆØ‡ÆÆ‡Øç', english: 'Sadhya' },
            { tamil: '‡Æö‡ØÅ‡Æ™‡ÆÆ‡Øç', english: 'Shubha' },
            { tamil: '‡Æö‡ØÅ‡Æï‡Øç‡Æ≤‡ÆÆ‡Øç', english: 'Shukla' },
            { tamil: '‡Æ™‡Øç‡Æ∞‡ÆÆ‡Øç‡ÆÆ‡ÆÆ‡Øç', english: 'Brahma' },
            { tamil: '‡Æê‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡ÆÆ‡Øç', english: 'Indra' },
            { tamil: '‡Æµ‡Øà‡Æ§‡Øç‡Æ∞‡ØÅ‡Æ§‡Æø', english: 'Vaidhriti' }
        ];
        
        // Tamil Months with Sanskrit equivalents
        const TAMIL_MONTHS = [
            { tamil: '‡Æö‡Æø‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Øà', english: 'Chithirai', sanskrit: '‡Æö‡Øà‡Æ§‡Øç‡Æ∞', sanskritEng: 'Chaitra' },
            { tamil: '‡Æµ‡Øà‡Æï‡Ææ‡Æö‡Æø', english: 'Vaikasi', sanskrit: '‡Æµ‡Øà‡Æö‡Ææ‡Æï', sanskritEng: 'Vaishakha' },
            { tamil: '‡ÆÜ‡Æ©‡Æø', english: 'Aani', sanskrit: '‡Æú‡Øç‡ÆØ‡Øá‡Æ∑‡Øç‡Æü', sanskritEng: 'Jyeshtha' },
            { tamil: '‡ÆÜ‡Æü‡Æø', english: 'Aadi', sanskrit: '‡ÆÜ‡Æ∑‡Ææ‡Æü', sanskritEng: 'Ashadha' },
            { tamil: '‡ÆÜ‡Æµ‡Æ£‡Æø', english: 'Aavani', sanskrit: '‡Æö‡Øç‡Æ∞‡Ææ‡Æµ‡Æ£', sanskritEng: 'Shravana' },
            { tamil: '‡Æ™‡ØÅ‡Æ∞‡Æü‡Øç‡Æü‡Ææ‡Æö‡Æø', english: 'Purattasi', sanskrit: '‡Æ™‡Ææ‡Æ§‡Øç‡Æ∞‡Æ™‡Æ§', sanskritEng: 'Bhadrapada' },
            { tamil: '‡Æê‡Æ™‡Øç‡Æ™‡Æö‡Æø', english: 'Aippasi', sanskrit: '‡ÆÜ‡Æö‡Øç‡Æµ‡Æø‡Æ©', sanskritEng: 'Ashwina' },
            { tamil: '‡Æï‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡Æï‡Øà', english: 'Karthigai', sanskrit: '‡Æï‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡Æï', sanskritEng: 'Kartika' },
            { tamil: '‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æï‡Æ¥‡Æø', english: 'Margazhi', sanskrit: '‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æï‡Æö‡ØÄ‡Æ∞‡Øç‡Æ∑', sanskritEng: 'Margashirsha' },
            { tamil: '‡Æ§‡Øà', english: 'Thai', sanskrit: '‡Æ™‡Øå‡Æ∑', sanskritEng: 'Pausha' },
            { tamil: '‡ÆÆ‡Ææ‡Æö‡Æø', english: 'Maasi', sanskrit: '‡ÆÆ‡Ææ‡Æï', sanskritEng: 'Magha' },
            { tamil: '‡Æ™‡Æô‡Øç‡Æï‡ØÅ‡Æ©‡Æø', english: 'Panguni', sanskrit: '‡Æ™‡Ææ‡Æ≤‡Øç‡Æï‡ØÅ‡Æ©', sanskritEng: 'Phalguna' }
        ];
        
        // Samvatsara (60-year cycle)
        const SAMVATSARAS = [
            '‡Æ™‡Æø‡Æ∞‡Æ™‡Æµ', '‡Æµ‡Æø‡Æ™‡Æµ', '‡Æö‡ØÅ‡Æï‡Øç‡Æ≤', '‡Æ™‡Æø‡Æ∞‡ÆÆ‡Øã‡Æ§‡ØÇ‡Æ§', '‡Æ™‡Æø‡Æ∞‡Æú‡Øã‡Æ§‡Øç‡Æ™‡Æ§‡Øç‡Æ§‡Æø', '‡ÆÜ‡Æô‡Øç‡Æï‡ØÄ‡Æ∞‡Æö', '‡Æ∏‡Øç‡Æ∞‡ØÄ‡ÆÆ‡ØÅ‡Æï', '‡Æ™‡Æµ', '‡ÆØ‡ØÅ‡Æµ', '‡Æ§‡Ææ‡Æ§‡ØÅ',
            '‡Æà‡Æ∏‡Øç‡Æµ‡Æ∞', '‡Æµ‡ØÜ‡Æï‡ØÅ‡Æ§‡Ææ‡Æ©‡Øç‡ÆØ', '‡Æ™‡Æø‡Æ∞‡ÆÆ‡Ææ‡Æ§‡Æø', '‡Æµ‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ∞‡ÆÆ', '‡Æµ‡Æø‡Æ∑‡ØÅ', '‡Æö‡Æø‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æ™‡Ææ‡Æ©‡ØÅ', '‡Æö‡ØÅ‡Æ™‡Ææ‡Æ©‡ØÅ', '‡Æ§‡Ææ‡Æ∞‡Æ£', '‡Æ™‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø‡Æ™', '‡Æµ‡Æø‡ÆØ',
            '‡Æö‡Æ∞‡Øç‡Æµ‡Æú‡Æø‡Æ§‡Øç', '‡Æö‡Æ∞‡Øç‡Æµ‡Æ§‡Ææ‡Æ∞‡Æø', '‡Æµ‡Æø‡Æ∞‡Øã‡Æ§‡Æø', '‡Æµ‡Æø‡Æï‡Øç‡Æ∞‡ØÅ‡Æ§‡Æø', '‡Æï‡Æ∞', '‡Æ®‡Æ®‡Øç‡Æ§‡Æ©', '‡Æµ‡Æø‡Æú‡ÆØ', '‡Æú‡ÆØ', '‡ÆÆ‡Æ©‡Øç‡ÆÆ‡Æ§', '‡Æ§‡ØÅ‡Æ∞‡Øç‡ÆÆ‡ØÅ‡Æï‡Æø',
            '‡Æπ‡Øá‡Æµ‡Æø‡Æ≥‡ÆÆ‡Øç‡Æ™‡Æø', '‡Æµ‡Æø‡Æ≥‡ÆÆ‡Øç‡Æ™‡Æø', '‡Æµ‡Æø‡Æï‡Ææ‡Æ∞‡Æø', '‡Æö‡Ææ‡Æ∞‡Øç‡Æµ‡Æ∞‡Æø', '‡Æ™‡Æø‡Æ≤‡Æµ', '‡Æö‡ØÅ‡Æ™‡Æï‡Æø‡Æ∞‡ØÅ‡Æ§‡ØÅ', '‡Æö‡Øã‡Æ™‡Æï‡Æø‡Æ∞‡ØÅ‡Æ§‡ØÅ', '‡Æï‡ØÅ‡Æ∞‡Øã‡Æ§‡Æø', '‡Æµ‡Æø‡Æö‡ØÅ‡Æµ‡Ææ‡Æµ‡Æö‡ØÅ', '‡Æ™‡Æ∞‡Ææ‡Æ™‡Æµ',
            '‡Æ™‡Æø‡Æ≤‡Æµ‡Æô‡Øç‡Æï', '‡Æï‡ØÄ‡Æ≤‡Æï', '‡Æö‡Øå‡ÆÆ‡Æø‡ÆØ', '‡Æö‡Ææ‡Æ§‡Ææ‡Æ∞‡Æ£', '‡Æµ‡Æø‡Æ∞‡Øã‡Æ§‡Æï‡Æø‡Æ∞‡ØÅ‡Æ§‡ØÅ', '‡Æ™‡Æ∞‡Æø‡Æ§‡Ææ‡Æ™‡Æø', '‡Æ™‡Æø‡Æ∞‡ÆÆ‡Ææ‡Æ§‡ØÄ‡Æö', '‡ÆÜ‡Æ©‡Æ®‡Øç‡Æ§', '‡Æ∞‡Ææ‡Æï‡Øç‡Æ∑‡Æö', '‡Æ®‡Æ≥',
            '‡Æ™‡Æø‡Æô‡Øç‡Æï‡Æ≥', '‡Æï‡Ææ‡Æ≥‡ÆØ‡ØÅ‡Æï‡Øç‡Æ§‡Æø', '‡Æö‡Æø‡Æ§‡Øç‡Æ§‡Ææ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æø', '‡Æ∞‡Øå‡Æ§‡Øç‡Æ∞‡Æø', '‡Æ§‡ØÅ‡Æ∞‡Øç‡ÆÆ‡Æ§‡Æø', '‡Æ§‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ‡Æ™‡Æø', '‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ∞‡Øã‡Æ§‡Øç‡Æï‡Ææ‡Æ∞‡Æø', '‡Æ∞‡Æï‡Øç‡Æ§‡Ææ‡Æï‡Øç‡Æ∑‡Æø', '‡Æï‡ØÅ‡Æ∞‡Øã‡Æ§‡Æ©', '‡ÆÖ‡Æï‡Øç‡Æ∑‡ÆØ'
        ];
        
        // Ritu (Seasons)
        const RITUS = [
            { tamil: '‡Æµ‡Æö‡Æ®‡Øç‡Æ§ ‡Æ∞‡ØÅ‡Æ§‡ØÅ', english: 'Vasanta (Spring)', months: [0, 1] },
            { tamil: '‡Æï‡Æø‡Æ∞‡ØÄ‡Æ∑‡Øç‡ÆÆ ‡Æ∞‡ØÅ‡Æ§‡ØÅ', english: 'Greeshma (Summer)', months: [2, 3] },
            { tamil: '‡Æµ‡Æ∞‡Øç‡Æ∑ ‡Æ∞‡ØÅ‡Æ§‡ØÅ', english: 'Varsha (Monsoon)', months: [4, 5] },
            { tamil: '‡Æö‡Æ∞‡Æ§‡Øç ‡Æ∞‡ØÅ‡Æ§‡ØÅ', english: 'Sharad (Autumn)', months: [6, 7] },
            { tamil: '‡Æπ‡Øá‡ÆÆ‡Æ®‡Øç‡Æ§ ‡Æ∞‡ØÅ‡Æ§‡ØÅ', english: 'Hemanta (Pre-winter)', months: [8, 9] },
            { tamil: '‡Æö‡Æø‡Æö‡Æø‡Æ∞ ‡Æ∞‡ØÅ‡Æ§‡ØÅ', english: 'Shishira (Winter)', months: [10, 11] }
        ];

        // 11 Karanas (7 repeat, 4 are fixed)
        const KARANAS = [
            { tamil: '‡Æ™‡Æµ‡ÆÆ‡Øç', english: 'Bava' },
            { tamil: '‡Æ™‡Ææ‡Æ≤‡Æµ‡ÆÆ‡Øç', english: 'Balava' },
            { tamil: '‡Æï‡Øå‡Æ≤‡Æµ‡ÆÆ‡Øç', english: 'Kaulava' },
            { tamil: '‡Æ§‡Øà‡Æ§‡ØÅ‡Æ≤‡ÆÆ‡Øç', english: 'Taitila' },
            { tamil: '‡Æï‡Æ∞‡Æú‡ÆÆ‡Øç', english: 'Garaja' },
            { tamil: '‡Æµ‡Æ£‡Æø‡Æú‡ÆÆ‡Øç', english: 'Vanija' },
            { tamil: '‡Æµ‡Æø‡Æ∑‡Øç‡Æü‡Æø', english: 'Vishti' },
            { tamil: '‡Æö‡Æï‡ØÅ‡Æ©‡Æø', english: 'Shakuni' },
            { tamil: '‡Æö‡Æ§‡ØÅ‡Æ∑‡Øç‡Æ™‡Ææ‡Æ§‡ÆÆ‡Øç', english: 'Chatushpada' },
            { tamil: '‡Æ®‡Ææ‡Æï‡ÆÆ‡Øç', english: 'Naga' },
            { tamil: '‡Æï‡Æø‡ÆÆ‡Øç‡Æ∏‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æ©‡ÆÆ‡Øç', english: 'Kimstughna' }
        ];
        
        // Calculate Panchang details with ending times using Astronomy Engine
        function calculatePanchang(year, month, day, hour, minute) {
            try {
                // Create date object for the exact time
                const date = new Date(year, month - 1, day, hour, minute);
                
                // Get precise planetary positions
                const planets = getAllPlanetaryPositions(year, month, day, hour, minute);
                const sunLong = planets.surya ? planets.surya.longitude : 270;
                const moonLong = planets.chandra ? planets.chandra.longitude : 270;
                
                // Moon longitude is already calculated for the exact time
                const adjustedMoonLong = moonLong;
                
                // Get Moon's actual daily motion for accurate end time calculations
                let moonDailyMotion = 13.176; // Default
                try {
                    moonDailyMotion = getMoonDailyMotion(date);
                } catch (e) {
                    console.log('Using default moon motion');
                }
                const moonSpeed = moonDailyMotion / 24; // degrees per hour
            
            // Tithi: Angular distance between Moon and Sun / 12
            let tithiAngle = adjustedMoonLong - sunLong;
            if (tithiAngle < 0) tithiAngle += 360;
            const tithiNum = Math.floor(tithiAngle / 12);
            const tithiIndex = tithiNum % 15;
            const paksha = tithiNum < 15 ? 'shukla' : 'krishna';
            
            // Calculate Tithi ending time
            const tithiProgress = (tithiAngle % 12) / 12; // Progress within current tithi
            const tithiRemaining = 1 - tithiProgress;
            const hoursToTithiEnd = (tithiRemaining * 12) / (moonSpeed - 0.04); // Moon-Sun relative speed
            const tithiEndTime = calculateEndTime(hour, minute, hoursToTithiEnd);
            
            // Nakshatra: Moon's longitude / 13.333
            const nakshatraDegree = 360 / 27;
            const nakshatraIndex = Math.floor(adjustedMoonLong / nakshatraDegree) % 27;
            
            // Calculate Nakshatra ending time
            const nakshatraProgress = (adjustedMoonLong % nakshatraDegree) / nakshatraDegree;
            const nakshatraRemaining = 1 - nakshatraProgress;
            const hoursToNakshatraEnd = (nakshatraRemaining * nakshatraDegree) / moonSpeed;
            const nakshatraEndTime = calculateEndTime(hour, minute, hoursToNakshatraEnd);
            
            // Yoga: (Sun longitude + Moon longitude) / 13.333
            let yogaAngle = (sunLong + adjustedMoonLong) % 360;
            const yogaIndex = Math.floor(yogaAngle / nakshatraDegree) % 27;
            
            // Calculate Yoga ending time
            const yogaProgress = (yogaAngle % nakshatraDegree) / nakshatraDegree;
            const yogaRemaining = 1 - yogaProgress;
            const hoursToYogaEnd = (yogaRemaining * nakshatraDegree) / (moonSpeed + 0.04);
            const yogaEndTime = calculateEndTime(hour, minute, hoursToYogaEnd);
            
            // Karana: Each tithi has 2 karanas
            const karanaNum = Math.floor(tithiAngle / 6) % 60;
            let karanaIndex;
            if (karanaNum === 0) karanaIndex = 10;
            else if (karanaNum >= 57) karanaIndex = 7 + (karanaNum - 57);
            else karanaIndex = (karanaNum - 1) % 7;
            
            // Day of week
            const dateForDay = new Date(year, month - 1, day);
            const dayOfWeek = dateForDay.getDay();
            
            // Solar Tamil month (based on Sun's position)
            const solarMonthIndex = Math.floor(sunLong / 30) % 12;
            
            // Lunar month calculation (Amant/Purnimant system)
            // The lunar month is named after the nakshatra where full moon occurs
            // During Krishna Paksha (after full moon), we're in the latter half of the lunar month
            // The lunar month is typically 1 position ahead during Krishna Paksha in late month
            let lunarMonthIndex = solarMonthIndex;
            
            // Calculate approximate tithi to determine lunar month
            // If we're in Krishna Paksha (tithi 15-30, i.e., after full moon)
            // and Sun is past 15¬∞ in the sign, lunar month advances
            const degreeInSign = sunLong % 30;
            if (paksha === 'krishna' && degreeInSign > 10) {
                lunarMonthIndex = (solarMonthIndex + 1) % 12;
            }
            
            // Calculate Tamil date (day of the solar month)
            // Using precise Sun position from Astronomy Engine
            const degreeInSolarSign = sunLong % 30;
            // Sun's average daily motion is ~0.9856¬∞, but use actual position
            const tamilDate = Math.floor(degreeInSolarSign / 0.9856) + 1;
            
            const tamilMonth = {
                ...TAMIL_MONTHS[lunarMonthIndex],
                solarMonth: TAMIL_MONTHS[solarMonthIndex],
                sanskritVara: SANSKRIT_DAYS[dayOfWeek],
                sanskritVaraEng: SANSKRIT_DAYS_ENG[dayOfWeek],
                tamilDate: tamilDate  // Day of the Tamil solar month
            };
            
            // Samvatsara (60-year cycle)
            // Hindu year (Chaitra) starts around April, so Jan-Mar use previous year
            // Shaka 1947 (2025-26) = Vishvavasu (index 38)
            const hinduYear = month < 4 ? year - 1 : year;
            const samvatsaraIndex = (hinduYear - 1987) % 60; // 1987 was Prabhava
            const samvatsara = SAMVATSARAS[samvatsaraIndex >= 0 ? samvatsaraIndex : samvatsaraIndex + 60];
            
            // Ritu (Season) - based on solar month
            const rituIndex = Math.floor(solarMonthIndex / 2);
            const ritu = RITUS[rituIndex];
            
            // Ayana - based on solar month
            const ayana = (solarMonthIndex >= 3 && solarMonthIndex <= 8) 
                ? { tamil: '‡Æ§‡Æï‡Øç‡Æ∑‡Æø‡Æ£‡Ææ‡ÆØ‡Æ©‡ÆÆ‡Øç', english: 'Dakshinayana' }
                : { tamil: '‡Æâ‡Æ§‡Øç‡Æ§‡Æ∞‡Ææ‡ÆØ‡Æ£‡ÆÆ‡Øç', english: 'Uttarayana' };
            
            return {
                tithi: {
                    ...TITHIS[tithiIndex],
                    number: tithiIndex + 1,
                    pakshNameTamil: paksha === 'shukla' ? '‡Æö‡ØÅ‡Æï‡Øç‡Æ≤' : '‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Øç‡Æ£',
                    pakshaNameEnglish: paksha === 'shukla' ? 'Shukla' : 'Krishna',
                    endTime: tithiEndTime
                },
                nakshatra: {
                    ...NAKSHATRAS[nakshatraIndex],
                    endTime: nakshatraEndTime
                },
                yoga: {
                    ...YOGAS[yogaIndex],
                    endTime: yogaEndTime
                },
                karana: KARANAS[karanaIndex],
                paksha: {
                    tamil: paksha === 'shukla' ? '‡Æö‡ØÅ‡Æï‡Øç‡Æ≤ ‡Æ™‡Æï‡Øç‡Æ∑‡ÆÆ‡Øç' : '‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Øç‡Æ£ ‡Æ™‡Æï‡Øç‡Æ∑‡ÆÆ‡Øç',
                    english: paksha === 'shukla' ? 'Shukla Paksha' : 'Krishna Paksha'
                },
                day: {
                    tamil: TAMIL_DAYS[dayOfWeek],
                    english: ENGLISH_DAYS[dayOfWeek]
                },
                tamilMonth: tamilMonth,
                samvatsara: samvatsara,
                ritu: ritu,
                ayana: ayana
            };
            } catch (e) {
                console.error('Error in calculatePanchang:', e);
                // Return a minimal valid object to prevent page crash
                return {
                    tithi: { tamil: 'Error', english: 'Error', number: 1, pakshNameTamil: '', pakshaNameEnglish: '', endTime: '' },
                    nakshatra: { tamil: 'Error', english: 'Error', endTime: '' },
                    yoga: { tamil: 'Error', english: 'Error', endTime: '' },
                    karana: { tamil: 'Error', english: 'Error' },
                    paksha: { tamil: '', english: '' },
                    day: { tamil: TAMIL_DAYS[new Date().getDay()], english: ENGLISH_DAYS[new Date().getDay()] },
                    tamilMonth: { tamil: '', english: '', solarMonth: { tamil: '', english: '' }, tamilDate: 0, sanskritVara: '', sanskritVaraEng: '' },
                    samvatsara: '',
                    ritu: { tamil: '', english: '' },
                    ayana: { tamil: '', english: '' }
                };
            }
        }
        
        // Helper to calculate end time
        function calculateEndTime(currentHour, currentMinute, hoursToAdd) {
            let totalMinutes = currentHour * 60 + currentMinute + Math.round(hoursToAdd * 60);
            let dayOffset = '';
            
            if (totalMinutes >= 24 * 60) {
                totalMinutes -= 24 * 60;
                dayOffset = '+';
            }
            if (totalMinutes < 0) {
                totalMinutes += 24 * 60;
            }
            
            const endHour = Math.floor(totalMinutes / 60);
            const endMinute = Math.round(totalMinutes % 60);
            
            return formatTimeObj({ hour: endHour, minute: endMinute }) + dayOffset;
        }
        
        // Rahu Kalam segment by day of week (0=Sunday, 1=Monday, etc.)
        // Day divided into 8 parts from sunrise to sunset
        const RAHU_KALAM_SEGMENTS = [7, 1, 6, 4, 5, 3, 2]; // Sun, Mon, Tue, Wed, Thu, Fri, Sat
        
        // Calculate Rahu Kalam time
        function calculateRahuKalam(location, localDate) {
            const loc = LOCATIONS[location];
            const tzOffset = getTimezoneOffset(loc.tz);
            
            // Calculate sunrise and sunset
            const sunTimes = calculateSunTimes(loc.lat, loc.lng, localDate.year, localDate.month, localDate.day);
            const sunrise = utcHoursToLocalTime(sunTimes.sunrise, tzOffset);
            const sunset = utcHoursToLocalTime(sunTimes.sunset, tzOffset);
            
            // Day duration in minutes
            const sunriseMinutes = sunrise.hour * 60 + sunrise.minute;
            const sunsetMinutes = sunset.hour * 60 + sunset.minute;
            const dayDuration = sunsetMinutes - sunriseMinutes;
            
            // Each segment duration
            const segmentDuration = dayDuration / 8;
            
            // Get Rahu Kalam segment for this day
            const dayOfWeek = localDate.dayOfWeek;
            const rahuSegment = RAHU_KALAM_SEGMENTS[dayOfWeek];
            
            // Calculate start and end times
            const rahuStartMinutes = sunriseMinutes + (rahuSegment * segmentDuration);
            const rahuEndMinutes = rahuStartMinutes + segmentDuration;
            
            const rahuStart = {
                hour: Math.floor(rahuStartMinutes / 60),
                minute: Math.round(rahuStartMinutes % 60)
            };
            const rahuEnd = {
                hour: Math.floor(rahuEndMinutes / 60),
                minute: Math.round(rahuEndMinutes % 60)
            };
            
            return {
                start: formatTimeObj(rahuStart),
                end: formatTimeObj(rahuEnd),
                startMinutes: rahuStartMinutes,
                endMinutes: rahuEndMinutes,
                sunrise: formatTimeObj(sunrise),
                sunset: formatTimeObj(sunset)
            };
        }
        
        // Check if current time is during Rahu Kalam
        function isRahuKalamNow(rahuKalam, localDate) {
            const currentMinutes = localDate.hour * 60 + localDate.minute;
            return currentMinutes >= rahuKalam.startMinutes && currentMinutes < rahuKalam.endMinutes;
        }

        // Generate Panchang HTML
        function generatePanchangHTML(localDate) {
            const panchang = calculatePanchang(localDate.year, localDate.month, localDate.day, localDate.hour, localDate.minute);
            const rahuKalam = calculateRahuKalam(currentLocation, localDate);
            const isRahuNow = isRahuKalamNow(rahuKalam, localDate);
            const loc = LOCATIONS[currentLocation];
            
            return `
                <div class="sankalpam-box">
                    <div class="sankalpam-title">üôè ‡Æö‡Æô‡Øç‡Æï‡Æ≤‡Øç‡Æ™‡ÆÆ‡Øç / Sankalpam</div>
                    <div class="sankalpam-text">
                        <span class="highlight">${panchang.samvatsara}</span> ‡Æ®‡Ææ‡ÆÆ ‡Æö‡ÆÆ‡Øç‡Æµ‡Æ§‡Øç‡Æö‡Æ∞‡Øá,
                        <span class="highlight">${panchang.ayana.tamil}</span>,
                        <span class="highlight">${panchang.ritu.tamil}</span>,
                        <span class="highlight">${panchang.tamilMonth.solarMonth.tamil} ‡ÆÆ‡Ææ‡Æö‡ÆÆ‡Øç ${panchang.tamilMonth.tamilDate} ‡ÆÜ‡ÆÆ‡Øç ‡Æ®‡Ææ‡Æ≥‡Øç</span>,
                        <span class="highlight">${panchang.paksha.tamil}</span>,
                        <span class="highlight">${panchang.tithi.pakshNameTamil} ${panchang.tithi.tamil}</span> ‡Æ§‡Æø‡Æ§‡Øå,
                        <span class="highlight">${panchang.tamilMonth.sanskritVara}</span> ‡Æµ‡Ææ‡Æ∏‡Æ∞‡Øá,
                        <span class="highlight">${panchang.nakshatra.tamil}</span> ‡Æ®‡Æï‡Øç‡Æ∑‡Æ§‡Øç‡Æ∞‡Øá,
                        <span class="highlight">${panchang.yoga.tamil}</span> ‡ÆØ‡Øã‡Æï‡Øá,
                        <span class="highlight">${panchang.karana.tamil}</span> ‡Æï‡Æ∞‡Æ£‡Øá,
                        ‡Æè‡Æµ‡Æô‡Øç‡Æï‡ØÅ‡Æ£ ‡Æµ‡Æø‡Æö‡Øá‡Æ∑‡Æ£ ‡Æµ‡Æø‡Æö‡Æø‡Æ∑‡Øç‡Æü‡Ææ‡ÆØ‡Ææ‡ÆÆ‡Øç ‡Æö‡ØÅ‡Æ™‡Æ§‡Æø‡Æ§‡Øå,
                        <span class="highlight">${loc.name}</span> ‡Æï‡Øç‡Æ∑‡Øá‡Æ§‡Øç‡Æ∞‡Øá...
                    </div>
                    <div class="sankalpam-english">
                        In the year <span class="highlight">${panchang.samvatsara}</span>,
                        during <span class="highlight">${panchang.ayana.english}</span>,
                        in <span class="highlight">${panchang.ritu.english}</span>,
                        <span class="highlight">${panchang.tamilMonth.solarMonth.english} ${panchang.tamilMonth.tamilDate}</span>,
                        <span class="highlight">${panchang.paksha.english}</span>,
                        on <span class="highlight">${panchang.tithi.pakshaNameEnglish} ${panchang.tithi.english}</span>,
                        <span class="highlight">${panchang.tamilMonth.sanskritVaraEng}</span> Vasara,
                        star <span class="highlight">${panchang.nakshatra.english}</span>,
                        yoga <span class="highlight">${panchang.yoga.english}</span>,
                        karana <span class="highlight">${panchang.karana.english}</span>,
                        at <span class="highlight">${loc.name}</span>...
                    </div>
                </div>
                
                <div class="panchang-grid">
                    <div class="panchang-item">
                        <div class="label">‡Æï‡Æø‡Æ¥‡ÆÆ‡Øà / Day</div>
                        <div class="value-tamil">${panchang.day.tamil}</div>
                        <div class="value-english">${panchang.day.english}</div>
                    </div>
                    <div class="panchang-item">
                        <div class="label">‡Æ§‡Æø‡Æ§‡Æø / Tithi</div>
                        <div class="value-tamil">${panchang.tithi.pakshNameTamil}-${panchang.tithi.tamil}</div>
                        <div class="value-english">${panchang.tithi.pakshaNameEnglish}-${panchang.tithi.english}</div>
                        <div class="end-time">till ${panchang.tithi.endTime}</div>
                    </div>
                    <div class="panchang-item">
                        <div class="label">‡Æ®‡Æü‡Øç‡Æö‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ÆÆ‡Øç / Nakshatra</div>
                        <div class="value-tamil">${panchang.nakshatra.tamil}</div>
                        <div class="value-english">${panchang.nakshatra.english}</div>
                        <div class="end-time">till ${panchang.nakshatra.endTime}</div>
                    </div>
                    <div class="panchang-item">
                        <div class="label">‡ÆØ‡Øã‡Æï‡ÆÆ‡Øç / Yoga</div>
                        <div class="value-tamil">${panchang.yoga.tamil}</div>
                        <div class="value-english">${panchang.yoga.english}</div>
                        <div class="end-time">till ${panchang.yoga.endTime}</div>
                    </div>
                    <div class="panchang-item">
                        <div class="label">‡Æï‡Æ∞‡Æ£‡ÆÆ‡Øç / Karana</div>
                        <div class="value-tamil">${panchang.karana.tamil}</div>
                        <div class="value-english">${panchang.karana.english}</div>
                    </div>
                    <div class="panchang-item">
                        <div class="label">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡Æ§‡Øá‡Æ§‡Æø / Tamil Date</div>
                        <div class="value-tamil">${panchang.tamilMonth.solarMonth.tamil} ${panchang.tamilMonth.tamilDate}</div>
                        <div class="value-english">${panchang.tamilMonth.solarMonth.english} ${panchang.tamilMonth.tamilDate}</div>
                    </div>
                    <div class="panchang-item ${isRahuNow ? 'rahu-active' : ''}">
                        <div class="label">‚òä ‡Æ∞‡Ææ‡Æï‡ØÅ ‡Æï‡Ææ‡Æ≤‡ÆÆ‡Øç / Rahu Kalam</div>
                        <div class="value-tamil">${rahuKalam.start} - ${rahuKalam.end}</div>
                        <div class="value-english">${isRahuNow ? '‚ö†Ô∏è Active Now!' : `üåÖ ${rahuKalam.sunrise} | üåá ${rahuKalam.sunset}`}</div>
                    </div>
                    <div class="panchang-item">
                        <div class="label">‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ ‡Æâ‡Æ§‡ÆØ‡ÆÆ‡Øç / Sunrise</div>
                        <div class="value-tamil">${rahuKalam.sunrise}</div>
                        <div class="value-english">Sunset: ${rahuKalam.sunset}</div>
                    </div>
                </div>
            `;
        }
        
        // ==================== END PANCHANG CALCULATIONS ====================

        // Navagraha (9 Planets) data with Tamil names
        const GRAHAS = {
            surya: { name: 'Sun', tamil: '‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ‡Æ©‡Øç', short: '‡Æö‡ØÇ', symbol: '‚òâ' },
            chandra: { name: 'Moon', tamil: '‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡Æ©‡Øç', short: '‡Æö', symbol: '‚òΩ' },
            mangal: { name: 'Mars', tamil: '‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç', short: '‡Æö‡ØÜ', symbol: '‚ôÇ' },
            budha: { name: 'Mercury', tamil: '‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç', short: '‡Æ™‡ØÅ', symbol: '‚òø' },
            guru: { name: 'Jupiter', tamil: '‡Æï‡ØÅ‡Æ∞‡ØÅ', short: '‡Æï‡ØÅ', symbol: '‚ôÉ' },
            shukra: { name: 'Venus', tamil: '‡Æö‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ∞‡Æ©‡Øç', short: '‡Æö‡ØÅ', symbol: '‚ôÄ' },
            shani: { name: 'Saturn', tamil: '‡Æö‡Æ©‡Æø', short: '‡Æö‡Æ©‡Æø', symbol: '‚ôÑ' },
            rahu: { name: 'Rahu', tamil: '‡Æ∞‡Ææ‡Æï‡ØÅ', short: '‡Æ∞‡Ææ', symbol: '‚òä' },
            ketu: { name: 'Ketu', tamil: '‡Æï‡Øá‡Æ§‡ØÅ', short: '‡Æï‡Øá', symbol: '‚òã' }
        };

        // ==================== ASTRONOMY ENGINE EPHEMERIS ====================
        
        // Check if Astronomy Engine is loaded and working
        let useAstronomyEngine = false;
        try {
            if (typeof Astronomy !== 'undefined' && Astronomy.MakeTime) {
                // Test if it works
                const testDate = Astronomy.MakeTime(new Date());
                const testSun = Astronomy.SunPosition(testDate);
                if (testSun && typeof testSun.elon === 'number') {
                    useAstronomyEngine = true;
                    console.log('Astronomy Engine loaded successfully');
                }
            }
        } catch (e) {
            console.log('Astronomy Engine not available, using fallback calculations');
            useAstronomyEngine = false;
        }
        
        // Get precise Lahiri Ayanamsa for a given date
        function getPreciseAyanamsa(date) {
            // Lahiri Ayanamsa: 23¬∞51'11" on Jan 1, 2000 (23.853¬∞)
            // Precession rate: ~50.29 arcseconds per year = 0.01397¬∞ per year
            const j2000 = new Date(2000, 0, 1);
            const yearsDiff = (date - j2000) / (365.25 * 24 * 60 * 60 * 1000);
            return 23.853 + (yearsDiff * 0.01397);
        }
        
        // Get ecliptic longitude using Astronomy Engine
        function getEclipticLongitude(body, date) {
            if (!useAstronomyEngine) return getFallbackLongitude(body, date);
            
            try {
                const astroDate = Astronomy.MakeTime(date);
                
                if (body === 'Sun') {
                    // Use SunPosition for the Sun
                    const sunPos = Astronomy.SunPosition(astroDate);
                    return sunPos.elon;
                } else if (body === 'Moon') {
                    // Use GeoMoon for the Moon
                    const moonVec = Astronomy.GeoMoon(astroDate);
                    const ecl = Astronomy.Ecliptic(moonVec);
                    return ecl.elon;
                } else {
                    // For other planets, use HelioVector then convert
                    const geo = Astronomy.GeoVector(body, astroDate, true);
                    const ecl = Astronomy.Ecliptic(geo);
                    return ecl.elon;
                }
            } catch (e) {
                console.error(`Astronomy Engine error for ${body}:`, e);
                return getFallbackLongitude(body, date);
            }
        }
        
        // Fallback longitude calculation (simple linear model)
        function getFallbackLongitude(body, date) {
            const refDate = new Date(2025, 11, 30); // Dec 30, 2025
            const daysDiff = (date - refDate) / (24 * 60 * 60 * 1000);
            const ayanamsa = getPreciseAyanamsa(date);
            
            // Reference tropical positions + daily motion
            const fallbackData = {
                'Sun': { ref: 256 + ayanamsa, rate: 0.9856 },
                'Moon': { ref: 16 + ayanamsa, rate: 13.176 },
                'Mars': { ref: 258 + ayanamsa, rate: 0.524 },
                'Mercury': { ref: 251 + ayanamsa, rate: 1.2 },
                'Jupiter': { ref: 68 + ayanamsa, rate: 0.083 },
                'Venus': { ref: 263 + ayanamsa, rate: 1.1 },
                'Saturn': { ref: 320 + ayanamsa, rate: 0.033 }
            };
            
            const data = fallbackData[body];
            if (!data) return 0;
            
            let longitude = data.ref + (daysDiff * data.rate);
            return ((longitude % 360) + 360) % 360;
        }
        
        // Get Moon's daily motion (for accurate nakshatra end time)
        function getMoonDailyMotion(date) {
            if (!useAstronomyEngine) return 13.176; // Average motion fallback
            
            try {
                const date1 = new Date(date.getTime());
                const date2 = new Date(date.getTime() + 24 * 60 * 60 * 1000);
                const long1 = getEclipticLongitude('Moon', date1);
                const long2 = getEclipticLongitude('Moon', date2);
                let motion = long2 - long1;
                if (motion < 0) motion += 360;
                if (motion > 20) motion = 13.176; // Sanity check
                return motion;
            } catch (e) {
                return 13.176; // Fallback to average
            }
        }
        
        // Calculate all planetary positions using Astronomy Engine (Sidereal/Vedic)
        function getAllPlanetaryPositions(year, month, day, hour = 12, minute = 0) {
            const date = new Date(year, month - 1, day, hour, minute);
            const ayanamsa = getPreciseAyanamsa(date);
            
            const positions = {};
            
            // Map of our planet keys to Astronomy Engine body names
            const bodyMap = {
                surya: 'Sun',
                chandra: 'Moon',
                mangal: 'Mars',
                budha: 'Mercury',
                guru: 'Jupiter',
                shukra: 'Venus',
                shani: 'Saturn'
            };
            
            // Calculate positions for main planets
            for (const [key, body] of Object.entries(bodyMap)) {
                try {
                    const tropicalLong = getEclipticLongitude(body, date);
                    let siderealLong = tropicalLong - ayanamsa;
                    siderealLong = ((siderealLong % 360) + 360) % 360;
                    const rashiIndex = Math.floor(siderealLong / 30);
                    
                    positions[key] = {
                        ...GRAHAS[key],
                        rashi: rashiIndex,
                        longitude: siderealLong,
                        tropicalLongitude: tropicalLong
                    };
                } catch (e) {
                    console.error(`Error calculating ${key}:`, e);
                }
            }
            
            // Calculate Rahu/Ketu (lunar nodes) - use simple calculation
            const refDate = new Date(2025, 11, 30);
            const daysDiff = (date - refDate) / (24 * 60 * 60 * 1000);
            let rahuLong = 318 - (daysDiff * 0.053); // Retrograde motion
            rahuLong = ((rahuLong % 360) + 360) % 360;
            const rahuRashi = Math.floor(rahuLong / 30);
            
            positions.rahu = {
                ...GRAHAS.rahu,
                rashi: rahuRashi,
                longitude: rahuLong
            };
            
            // Ketu is always opposite Rahu
            let ketuLong = (rahuLong + 180) % 360;
            const ketuRashi = Math.floor(ketuLong / 30);
            
            positions.ketu = {
                ...GRAHAS.ketu,
                rashi: ketuRashi,
                longitude: ketuLong
            };
            
            return positions;
        }
        
        // ==================== END ASTRONOMY ENGINE EPHEMERIS ====================

        // Generate South Indian style Jathaga Kattam (‡Æú‡Ææ‡Æ§‡Æï ‡Æï‡Æü‡Øç‡Æü‡ÆÆ‡Øç)
        function generateJathagaKattam(lagnaIndex) {
            const loc = LOCATIONS[currentLocation];
            const now = new Date();
            const localDate = getDateInTimezone(now, loc.tz);
            
            // Get all planetary positions
            const planets = getAllPlanetaryPositions(localDate.year, localDate.month, localDate.day);
            
            // Group planets by rashi
            const planetsByRashi = {};
            for (const [key, planet] of Object.entries(planets)) {
                if (!planetsByRashi[planet.rashi]) {
                    planetsByRashi[planet.rashi] = [];
                }
                planetsByRashi[planet.rashi].push(planet);
            }
            
            // South Indian chart - fixed rashi positions
            const chartLayout = [
                { rashi: 11, row: 1, col: 1 }, { rashi: 0, row: 1, col: 2 },
                { rashi: 1, row: 1, col: 3 }, { rashi: 2, row: 1, col: 4 },
                { rashi: 10, row: 2, col: 1 }, { rashi: 3, row: 2, col: 4 },
                { rashi: 9, row: 3, col: 1 }, { rashi: 4, row: 3, col: 4 },
                { rashi: 8, row: 4, col: 1 }, { rashi: 7, row: 4, col: 2 },
                { rashi: 6, row: 4, col: 3 }, { rashi: 5, row: 4, col: 4 }
            ];
            
            // Helper to generate cell content
            function generateCell(rashiIdx, row, col) {
                const isLagna = rashiIdx === lagnaIndex;
                const rashiPlanets = planetsByRashi[rashiIdx] || [];
                const planetHtml = rashiPlanets.length > 0 
                    ? `<div class="planet-markers">${rashiPlanets.map(p => `<span class="planet-name" title="${p.name}">${p.short}</span>`).join(' ')}</div>` 
                    : '';
                
                return `
                    <div class="rashi-cell ${isLagna ? 'lagna' : ''} ${rashiPlanets.length > 0 ? 'has-planet' : ''}" style="grid-row: ${row}; grid-column: ${col};">
                        <span class="rashi-number">${rashiIdx + 1}</span>
                        ${planetHtml}
                        ${isLagna ? '<span class="lagna-marker">‡Æ≤</span>' : ''}
                    </div>
                `;
            }
            
            let cells = [];
            
            // Row 1
            for (let col = 1; col <= 4; col++) {
                const cell = chartLayout.find(c => c.row === 1 && c.col === col);
                cells.push(generateCell(cell.rashi, 1, col));
            }
            
            // Row 2 - left cell
            cells.push(generateCell(10, 2, 1));
            
            // Center cell with planet legend
            const dateStr = now.toLocaleDateString('ta-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: loc.tz });
            cells.push(`
                <div class="rashi-cell center" style="grid-row: 2 / 4; grid-column: 2 / 4;">
                    <div style="font-size: 1.2em; margin-bottom: 5px;">üïâÔ∏è ‡Æ∞‡Ææ‡Æö‡Æø ‡Æï‡Æü‡Øç‡Æü‡ÆÆ‡Øç</div>
                    <div style="font-size: 0.65em; opacity: 0.9; margin-bottom: 8px;">${dateStr}</div>
                    <div style="font-size: 0.55em; opacity: 0.85; line-height: 1.7; text-align: left; padding: 0 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px;">
                            <span>‡Æö‡ØÇ - ‡Æö‡ØÇ‡Æ∞‡Æø‡ÆØ‡Æ©‡Øç</span><span>‡Æö - ‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡Æ©‡Øç</span>
                            <span>‡Æö‡ØÜ - ‡Æö‡ØÜ‡Æµ‡Øç‡Æµ‡Ææ‡ÆØ‡Øç</span><span>‡Æ™‡ØÅ - ‡Æ™‡ØÅ‡Æ§‡Æ©‡Øç</span>
                            <span>‡Æï‡ØÅ - ‡Æï‡ØÅ‡Æ∞‡ØÅ</span><span>‡Æö‡ØÅ - ‡Æö‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ∞‡Æ©‡Øç</span>
                            <span>‡Æö‡Æ©‡Æø - ‡Æö‡Æ©‡Æø</span><span>‡Æ∞‡Ææ - ‡Æ∞‡Ææ‡Æï‡ØÅ</span>
                            <span>‡Æï‡Øá - ‡Æï‡Øá‡Æ§‡ØÅ</span><span>‡Æ≤ - ‡Æ≤‡Æï‡Øç‡Æ©‡ÆÆ‡Øç</span>
                        </div>
                    </div>
                </div>
            `);
            
            // Row 2 - right cell
            cells.push(generateCell(3, 2, 4));
            
            // Row 3 - left and right
            cells.push(generateCell(9, 3, 1));
            cells.push(generateCell(4, 3, 4));
            
            // Row 4
            for (let col = 1; col <= 4; col++) {
                const cell = chartLayout.find(c => c.row === 4 && c.col === col);
                cells.push(generateCell(cell.rashi, 4, col));
            }
            
            return cells.join('');
        }

        // Render the page
        function render() {
            try {
            const loc = LOCATIONS[currentLocation];
            const now = new Date();
            const localDate = getDateInTimezone(now, loc.tz);
            
            // Update header with proper timezone display
            document.getElementById('location-display').textContent = `üìç ${loc.name}`;
            // Get panchang for Tamil date display in header
            const panchangHeader = calculatePanchang(localDate.year, localDate.month, localDate.day, localDate.hour, localDate.minute);
            
            let tamilDateStr = '';
            try {
                tamilDateStr = `<br><span style="color: #fbbf24; font-weight: 500;">üóìÔ∏è ${panchangHeader.tamilMonth.solarMonth.tamil} ${panchangHeader.tamilMonth.tamilDate} (${panchangHeader.tamilMonth.solarMonth.english} ${panchangHeader.tamilMonth.tamilDate})</span>`;
            } catch (e) {
                console.log('Tamil date display error:', e);
            }
            
            document.getElementById('datetime-display').innerHTML = 
                `üìÖ ${now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: loc.tz })} | üïê ${now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true, timeZone: loc.tz })}${tamilDateStr}`;
            
            // Calculate Hora schedule
            const data = calculateHoraSchedule(currentLocation);
            const { current, index, next } = findCurrentHora(data.schedule, data.localDate, data.sunset);
            
            // Calculate Lagna
            const lagnaSchedule = calculateLagnaSchedule(currentLocation);
            const currentLagnaData = findCurrentLagnaFromSchedule(lagnaSchedule, localDate);
            const currentLagna = currentLagnaData.current;
            const nextLagna = currentLagnaData.next;
            
            // Jupiter horas
            const jupiterHoras = data.schedule.filter(h => h.planet === 'Jupiter');
            
            // Generate HTML
            let html = `
                <div class="dual-panel">
                    <div class="current-hora ${current.quality}">
                        <div class="planet">${current.emoji}</div>
                        <div class="name">${current.planet} Hora</div>
                        <div class="rashi-sanskrit">${current.tamil} ‡Æπ‡Øã‡Æ∞‡Øà</div>
                        <div class="time-range">${current.start} - ${current.end}</div>
                        <div class="quality">${current.quality === 'good' ? '‚úÖ Auspicious' : current.quality === 'avoid' ? '‚ö†Ô∏è Avoid' : 'üî∏ Neutral'}</div>
                        ${next ? `<p style="margin-top: 15px; color: #64748b;">Next: ${next.emoji} ${next.planet} / ${next.tamil} (${next.start})</p>` : ''}
                    </div>
                    
                    <div class="current-lagna">
                        <div class="rashi-symbol">${currentLagna.symbol}</div>
                        <div class="rashi-name">${currentLagna.name} Lagna</div>
                        <div class="rashi-sanskrit">${currentLagna.tamil} ‡Æ≤‡Æï‡Øç‡Æ©‡ÆÆ‡Øç</div>
                        <div class="time-range">${currentLagna.start} - ${currentLagna.end}</div>
                        <div class="element">${currentLagna.element.charAt(0).toUpperCase() + currentLagna.element.slice(1)} Sign ‚Ä¢ ${currentLagna.ruler} / ${currentLagna.rulerTamil}</div>
                        ${nextLagna ? `<p style="margin-top: 15px; opacity: 0.85;">Next: ${nextLagna.symbol} ${nextLagna.name} / ${nextLagna.tamil} (${nextLagna.start})</p>` : ''}
                    </div>
                </div>
                
                <div class="panchang-container">
                    <h2>üìÖ ‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æ™‡Æû‡Øç‡Æö‡Ææ‡Æô‡Øç‡Æï‡ÆÆ‡Øç / Today's Panchang</h2>
                    ${generatePanchangHTML(localDate)}
                </div>
                
                <div class="jupiter-box">
                    <h2>‚ôÉ Jupiter / ‡Æï‡ØÅ‡Æ∞‡ØÅ Hora Times (Most Auspicious)</h2>
                    <ul>
                        ${jupiterHoras.map(h => `<li>${h.start} - ${h.end}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="jathaga-container">
                    <h2>üîÆ ‡Æú‡Ææ‡Æ§‡Æï ‡Æï‡Æü‡Øç‡Æü‡ÆÆ‡Øç / Jathaga Kattam (Daily Chart)</h2>
                    <div class="jathaga-kattam">
                        ${generateJathagaKattam(currentLagna.index)}
                    </div>
                    <p style="text-align: center; margin-top: 15px; color: #64748b; font-size: 0.9em;">
                        Current Lagna / ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æ≤‡Æï‡Øç‡Æ©‡ÆÆ‡Øç: <strong style="color: #f59e0b;">${currentLagna.symbol} ${currentLagna.tamil} (${currentLagna.name})</strong>
                    </p>
                </div>
                
                <div class="lagna-schedule">
                    <h2>üåü Today's Lagna (Ascendant) Schedule / ‡Æ≤‡Æï‡Øç‡Æ© ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà</h2>
                    <table>
                        <thead><tr><th>#</th><th>Lagna</th><th>Tamil</th><th>Time</th><th>Element</th><th>Ruler</th></tr></thead>
                        <tbody>
                            ${lagnaSchedule.map((l, i) => `
                                <tr class="${l.element} ${l.index === currentLagna.index ? 'lagna-current' : ''}">
                                    <td>${i + 1}</td>
                                    <td>${l.symbol} ${l.name}</td>
                                    <td>${l.tamil}</td>
                                    <td>${l.start} - ${l.end}</td>
                                    <td>${l.element.charAt(0).toUpperCase() + l.element.slice(1)}</td>
                                    <td>${l.ruler} / ${l.rulerTamil}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="schedule">
                    <h2>‚òÄÔ∏è Day Hora / ‡Æ™‡Æï‡Æ≤‡Øç ‡Æπ‡Øã‡Æ∞‡Øà (Sunrise ${data.sunrise} ‚Üí Sunset ${data.sunset})</h2>
                    <table>
                        <thead><tr><th>#</th><th>Planet / ‡Æï‡Æø‡Æ∞‡Æï‡ÆÆ‡Øç</th><th>Tamil</th><th>Time</th><th>Nature</th><th>Status</th></tr></thead>
                        <tbody>
                            ${data.schedule.slice(0, 12).map((h, i) => `
                                <tr class="${h.quality} ${i === index ? 'current' : ''}">
                                    <td>${i + 1}</td>
                                    <td>${h.emoji} ${h.planet}</td>
                                    <td>${h.tamil}</td>
                                    <td>${h.start} - ${h.end}</td>
                                    <td>${h.nature}</td>
                                    <td style="font-weight: bold;">${h.quality === 'good' ? '‚úì' : h.quality === 'avoid' ? '‚úó' : '~'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="schedule">
                    <h2>üåô Night Hora / ‡Æá‡Æ∞‡Æµ‡ØÅ ‡Æπ‡Øã‡Æ∞‡Øà (Sunset ‚Üí Next Sunrise)</h2>
                    <table>
                        <thead><tr><th>#</th><th>Planet / ‡Æï‡Æø‡Æ∞‡Æï‡ÆÆ‡Øç</th><th>Tamil</th><th>Time</th><th>Nature</th><th>Status</th></tr></thead>
                        <tbody>
                            ${data.schedule.slice(12).map((h, i) => `
                                <tr class="${h.quality} ${i + 12 === index ? 'current' : ''}">
                                    <td>${i + 1}</td>
                                    <td>${h.emoji} ${h.planet}</td>
                                    <td>${h.tamil}</td>
                                    <td>${h.start} - ${h.end}</td>
                                    <td>${h.nature}</td>
                                    <td style="font-weight: bold;">${h.quality === 'good' ? '‚úì' : h.quality === 'avoid' ? '‚úó' : '~'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
            } catch (e) {
                console.error('Render error:', e);
                document.getElementById('content').innerHTML = `
                    <div style="background: #fee2e2; color: #991b1b; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h3>Error loading Panchangam</h3>
                        <p>Error: ${e.message}</p>
                        <p>Please refresh the page or try again later.</p>
                        <pre style="font-size: 0.8em; overflow: auto;">${e.stack}</pre>
                    </div>
                `;
            }
        }

        function changeLocation() {
            currentLocation = document.getElementById('city-select').value;
            render();
        }

        // Initial render
        render();
        
        // Update every minute
        setInterval(render, 60000);
    </script>
</body>
</html>

